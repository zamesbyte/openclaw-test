# OpenClaw é‚®ç®±è‡ªåŠ¨æ”¶ä»¶ + å†…å®¹æ€»ç»“ + ç”¨æˆ·é€šçŸ¥ æ–¹æ¡ˆ

> åˆ›å»ºæ—¥æœŸ: 2026-02-16
> çŠ¶æ€: æ–¹æ¡ˆè®¾è®¡é˜¶æ®µï¼ˆæœªå®žçŽ°ï¼‰

---

## ä¸€ã€éœ€æ±‚æ¦‚è¿°

å®žçŽ° OpenClaw è‡ªåŠ¨ç›‘å¬é‚®ç®±æ”¶ä»¶ï¼Œå¯¹æ–°é‚®ä»¶è¿›è¡Œ AI æ€»ç»“ï¼Œå¹¶é€šè¿‡å·²æœ‰é€šé“ï¼ˆé£žä¹¦/Discordï¼‰é€šçŸ¥ç”¨æˆ·ã€‚

### 1.1 åŠŸèƒ½ç›®æ ‡

```
é‚®ç®±æ–°é‚®ä»¶ â†’ OpenClaw è‡ªåŠ¨æŠ“å– â†’ AI æ€»ç»“å†…å®¹ â†’ æŽ¨é€é€šçŸ¥åˆ°é£žä¹¦/Discord
```

### 1.2 æ ¸å¿ƒèƒ½åŠ›

| èƒ½åŠ› | è¯´æ˜Ž |
|------|------|
| è‡ªåŠ¨æ”¶ä»¶ | é€šè¿‡ IMAP åè®®å®žæ—¶ç›‘å¬æ–°é‚®ä»¶ |
| å†…å®¹è§£æž | è§£æžé‚®ä»¶æ­£æ–‡ï¼ˆHTML/çº¯æ–‡æœ¬ï¼‰ã€é™„ä»¶åã€å‘ä»¶äººã€ä¸»é¢˜ |
| AI æ€»ç»“ | ä½¿ç”¨ qwen-max å¯¹é‚®ä»¶å†…å®¹ç”Ÿæˆç»“æž„åŒ–æ‘˜è¦ |
| ç”¨æˆ·é€šçŸ¥ | é€šè¿‡é£žä¹¦/Discord ç­‰å·²é…ç½®é€šé“æŽ¨é€æ€»ç»“ |
| è¿‡æ»¤è§„åˆ™ | æŒ‰å‘ä»¶äºº/ä¸»é¢˜/æ ‡ç­¾è¿‡æ»¤éœ€è¦é€šçŸ¥çš„é‚®ä»¶ |
| åŽ†å²æŸ¥è¯¢ | é€šè¿‡å¯¹è¯æŸ¥è¯¢å·²å¤„ç†çš„é‚®ä»¶è®°å½• |

---

## äºŒã€æŠ€æœ¯æ–¹æ¡ˆ

### 2.1 æ•´ä½“æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     IMAP/IDLE      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é‚®ç®±æœåŠ¡å™¨   â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  OpenClaw é‚®ä»¶    â”‚
â”‚  (Gmail/QQ/   â”‚ â”€â”€â”€â”€ æ–°é‚®ä»¶æŽ¨é€ â†’ â”‚  ç›‘å¬æœåŠ¡         â”‚
â”‚   ä¼ä¸šé‚®ç®±)   â”‚                   â”‚  (IMAP Listener)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚ æ–°é‚®ä»¶äº‹ä»¶
                                            â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  OpenClaw Agent   â”‚
                                   â”‚  (qwen-max)       â”‚
                                   â”‚                   â”‚
                                   â”‚  1. è§£æžé‚®ä»¶      â”‚
                                   â”‚  2. AI æ€»ç»“       â”‚
                                   â”‚  3. åˆ†ç±» & ä¼˜å…ˆçº§ â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚ æ€»ç»“ç»“æžœ
                                            â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  é€šçŸ¥åˆ†å‘         â”‚
                                   â”‚                   â”‚
                                   â”‚  â”œâ”€ é£žä¹¦æ¶ˆæ¯      â”‚
                                   â”‚  â”œâ”€ Discord DM    â”‚
                                   â”‚  â””â”€ è®°å¿†å­˜å‚¨      â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ–¹æ¡ˆé€‰åž‹

#### æ–¹æ¡ˆ A: OpenClaw æ’ä»¶ï¼ˆæŽ¨èï¼‰

åˆ©ç”¨ OpenClaw çš„æ’ä»¶æœºåˆ¶ï¼Œå¼€å‘ `email` æ’ä»¶ã€‚

**ä¼˜ç‚¹:**
- æ·±åº¦é›†æˆ OpenClaw ç”Ÿæ€
- å¯ä½¿ç”¨ Agent å·¥å…·é“¾ï¼ˆmemory, browser ç­‰ï¼‰
- æ”¯æŒé€šè¿‡å¯¹è¯äº¤äº’ç®¡ç†

**ç¼ºç‚¹:**
- éœ€è¦å¼€å‘ OpenClaw æ’ä»¶ï¼ˆTypeScriptï¼‰
- éœ€è¦äº†è§£ OpenClaw æ’ä»¶ API

#### æ–¹æ¡ˆ B: å¤–éƒ¨è„šæœ¬ + Webhook

ç¼–å†™ç‹¬ç«‹çš„é‚®ä»¶ç›‘å¬è„šæœ¬ï¼Œé€šè¿‡ OpenClaw Webhook è§¦å‘é€šçŸ¥ã€‚

**ä¼˜ç‚¹:**
- å¼€å‘ç‹¬ç«‹ï¼Œä¸ä¾èµ– OpenClaw å†…éƒ¨ API
- è¯­è¨€è‡ªç”±ï¼ˆPython/Node.js å‡å¯ï¼‰
- å¿«é€ŸåŽŸåž‹

**ç¼ºç‚¹:**
- AI æ€»ç»“éœ€è¦ç‹¬ç«‹è°ƒç”¨ LLM API
- æ— æ³•åˆ©ç”¨ OpenClaw çš„ memory å’Œ agent ä¸Šä¸‹æ–‡

#### æ–¹æ¡ˆ C: Cron å®šæ—¶ä»»åŠ¡ + Agent æ¶ˆæ¯

é€šè¿‡ OpenClaw Cron å®šæ—¶è§¦å‘ Agent æ£€æŸ¥é‚®ä»¶ã€‚

**ä¼˜ç‚¹:**
- æœ€ç®€å•ï¼Œåˆ©ç”¨çŽ°æœ‰ Cron æœºåˆ¶
- æ— éœ€é¢å¤–å¼€å‘

**ç¼ºç‚¹:**
- éžå®žæ—¶ï¼ˆå–å†³äºŽ Cron é—´éš”ï¼‰
- éœ€è¦ Agent æœ‰é‚®ä»¶è¯»å–å·¥å…·

### 2.3 æŽ¨èæ–¹æ¡ˆ: æ–¹æ¡ˆ Bï¼ˆå¤–éƒ¨è„šæœ¬ + Webhookï¼‰

ç†ç”±ï¼š
1. å¼€å‘é€Ÿåº¦å¿«ï¼Œä¸éœ€è¦ä¿®æ”¹ OpenClaw æºç 
2. å¯ç”¨ Python åˆ©ç”¨æˆç†Ÿçš„ IMAP åº“
3. é€šè¿‡ Webhook ä¸Ž OpenClaw æ— ç¼é›†æˆ
4. AI æ€»ç»“å¯ç›´æŽ¥è°ƒç”¨ DashScope API

---

## ä¸‰ã€è¯¦ç»†è®¾è®¡

### 3.1 é‚®ä»¶ç›‘å¬æœåŠ¡

**æŠ€æœ¯æ ˆ:** Python 3.11+

**æ ¸å¿ƒä¾èµ–:**
- `imapclient` â€” IMAP å®¢æˆ·ç«¯ï¼ˆæ”¯æŒ IDLE æŽ¨é€ï¼‰
- `email` â€” æ ‡å‡†åº“ï¼Œé‚®ä»¶è§£æž
- `beautifulsoup4` â€” HTML é‚®ä»¶è§£æž
- `openai` â€” DashScope å…¼å®¹ API è°ƒç”¨
- `requests` â€” Webhook è°ƒç”¨

**IMAP IDLE ç›‘å¬:**
```python
# ä¼ªä»£ç  - å®žæ—¶ç›‘å¬æ–°é‚®ä»¶
import imapclient

client = imapclient.IMAPClient('imap.example.com', ssl=True)
client.login('user@example.com', 'app-password')
client.select_folder('INBOX')

while True:
    # IDLE æ¨¡å¼: æœåŠ¡å™¨æŽ¨é€æ–°é‚®ä»¶é€šçŸ¥
    client.idle()
    responses = client.idle_check(timeout=300)  # 5åˆ†é’Ÿè¶…æ—¶

    if responses:
        # èŽ·å–æ–°é‚®ä»¶
        messages = client.search(['UNSEEN'])
        for uid in messages:
            raw = client.fetch([uid], ['BODY[]', 'ENVELOPE'])
            # è§£æž â†’ æ€»ç»“ â†’ é€šçŸ¥
            process_email(raw)

    client.idle_done()
```

### 3.2 é‚®ä»¶è§£æž

```python
# ä¼ªä»£ç  - é‚®ä»¶å†…å®¹æå–
def parse_email(raw_message):
    msg = email.message_from_bytes(raw_message)

    return {
        "subject": decode_header(msg["Subject"]),
        "from": decode_header(msg["From"]),
        "to": decode_header(msg["To"]),
        "date": msg["Date"],
        "body": extract_body(msg),        # çº¯æ–‡æœ¬æˆ– HTMLâ†’æ–‡æœ¬
        "attachments": extract_attachments(msg),  # é™„ä»¶ååˆ—è¡¨
        "has_attachments": bool(msg.get_payload()),
    }
```

### 3.3 AI æ€»ç»“

```python
# ä¼ªä»£ç  - ä½¿ç”¨ DashScope æ€»ç»“é‚®ä»¶
from openai import OpenAI

client = OpenAI(
    api_key="sk-251f...f5e7",
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1"
)

def summarize_email(parsed_email):
    prompt = f"""è¯·å¯¹ä»¥ä¸‹é‚®ä»¶è¿›è¡Œç»“æž„åŒ–æ€»ç»“ï¼š

å‘ä»¶äºº: {parsed_email['from']}
ä¸»é¢˜: {parsed_email['subject']}
æ—¶é—´: {parsed_email['date']}
é™„ä»¶: {', '.join(parsed_email['attachments']) or 'æ— '}

æ­£æ–‡:
{parsed_email['body'][:3000]}

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š
ðŸ“¬ **ä¸»é¢˜**: ...
ðŸ‘¤ **å‘ä»¶äºº**: ...
ðŸ“ **æ‘˜è¦**: (2-3å¥è¯æ€»ç»“æ ¸å¿ƒå†…å®¹)
ðŸ·ï¸ **åˆ†ç±»**: (å·¥ä½œ/é€šçŸ¥/è¥é”€/ä¸ªäºº/å…¶ä»–)
âš¡ **ä¼˜å…ˆçº§**: (é«˜/ä¸­/ä½Ž)
ðŸ“Ž **é™„ä»¶**: (å¦‚æœ‰)
ðŸ’¡ **éœ€è¦è¡ŒåŠ¨**: (æ˜¯/å¦ï¼Œå¦‚éœ€è¦è¯·è¯´æ˜Ž)"""

    response = client.chat.completions.create(
        model="qwen-max",
        messages=[{"role": "user", "content": prompt}],
        max_tokens=500
    )
    return response.choices[0].message.content
```

### 3.4 é€šçŸ¥æŽ¨é€

#### 3.4.1 é€šè¿‡ OpenClaw Webhook

```python
# ä¼ªä»£ç  - é€šè¿‡ OpenClaw Webhook æŽ¨é€é€šçŸ¥
import requests

def notify_via_openclaw(summary, channel="feishu"):
    webhook_url = "http://127.0.0.1:18789/webhooks/email-notify"

    requests.post(webhook_url, json={
        "event": "new_email",
        "summary": summary,
        "channel": channel,
        "headers": {
            "Authorization": f"Bearer {GATEWAY_TOKEN}"
        }
    })
```

#### 3.4.2 ç›´æŽ¥é€šè¿‡é£žä¹¦ API

```python
# ä¼ªä»£ç  - ç›´æŽ¥è°ƒç”¨é£žä¹¦ API æŽ¨é€
def notify_via_feishu(summary, user_id):
    url = "https://open.feishu.cn/open-apis/im/v1/messages"
    headers = {
        "Authorization": f"Bearer {get_tenant_access_token()}",
        "Content-Type": "application/json"
    }
    data = {
        "receive_id": user_id,
        "msg_type": "interactive",  # å¡ç‰‡æ¶ˆæ¯
        "content": build_feishu_card(summary)
    }
    requests.post(url, headers=headers, json=data,
                  params={"receive_id_type": "open_id"})
```

### 3.5 è¿‡æ»¤è§„åˆ™

```yaml
# é‚®ä»¶è¿‡æ»¤è§„åˆ™ç¤ºä¾‹é…ç½®
filters:
  # ç™½åå• - å¿…å®šé€šçŸ¥
  always_notify:
    - from: "*@company.com"      # å…¬å¸é‚®ä»¶
    - from: "boss@example.com"   # ç‰¹å®šå‘ä»¶äºº
    - subject: "ç´§æ€¥*"           # ä¸»é¢˜åŒ…å«å…³é”®è¯

  # é»‘åå• - ä¸é€šçŸ¥
  never_notify:
    - from: "*@marketing.com"    # è¥é”€é‚®ä»¶
    - subject: "è®¢é˜…*"           # è®¢é˜…é€šçŸ¥

  # é™é»˜æ—¶æ®µ - ä»…é«˜ä¼˜å…ˆçº§é€šçŸ¥
  quiet_hours:
    start: "22:00"
    end: "08:00"
    min_priority: "é«˜"

  # æ±‡æ€»æ¨¡å¼ - ä½Žä¼˜å…ˆçº§é‚®ä»¶æ‰“åŒ…é€šçŸ¥
  digest:
    enabled: true
    interval: "1h"               # æ¯å°æ—¶æ±‡æ€»ä¸€æ¬¡
    min_count: 3                 # è‡³å°‘ 3 å°æ‰æ±‡æ€»
```

---

## å››ã€é…ç½®æ¸…å•

### 4.1 é‚®ç®±é…ç½®

| é…ç½®é¡¹ | è¯´æ˜Ž | ç¤ºä¾‹ |
|--------|------|------|
| IMAP æœåŠ¡å™¨ | é‚®ä»¶æœåŠ¡å™¨åœ°å€ | `imap.gmail.com` / `imap.qq.com` |
| IMAP ç«¯å£ | é€šå¸¸ 993 (SSL) | `993` |
| é‚®ç®±è´¦å· | ç™»å½•é‚®ç®± | `user@example.com` |
| åº”ç”¨å¯†ç  | ä¸“ç”¨å¯†ç ï¼ˆéžè´¦å·å¯†ç ï¼‰ | Gmail éœ€å¼€å¯ä¸¤æ­¥éªŒè¯åŽç”Ÿæˆ |
| ç›‘å¬æ–‡ä»¶å¤¹ | ç›‘å¬çš„é‚®ç®±æ–‡ä»¶å¤¹ | `INBOX` |

### 4.2 å¸¸è§é‚®ç®± IMAP é…ç½®

| é‚®ç®± | IMAP æœåŠ¡å™¨ | ç«¯å£ | å¤‡æ³¨ |
|------|------------|------|------|
| Gmail | imap.gmail.com | 993 | éœ€å¼€å¯ IMAP + åº”ç”¨å¯†ç  |
| QQ é‚®ç®± | imap.qq.com | 993 | éœ€å¼€å¯ IMAP + æŽˆæƒç  |
| 163 é‚®ç®± | imap.163.com | 993 | éœ€å¼€å¯ IMAP + æŽˆæƒç  |
| Outlook | outlook.office365.com | 993 | Microsoft 365 é‚®ç®± |
| ä¼ä¸šå¾®ä¿¡é‚®ç®± | imap.exmail.qq.com | 993 | è…¾è®¯ä¼ä¸šé‚®ç®± |
| é˜¿é‡Œä¼ä¸šé‚®ç®± | imap.qiye.aliyun.com | 993 | é˜¿é‡Œäº‘ä¼ä¸šé‚®ç®± |

### 4.3 OpenClaw é€šçŸ¥é…ç½®

| é…ç½®é¡¹ | è¯´æ˜Ž |
|--------|------|
| é€šçŸ¥æ¸ é“ | `feishu` (å·²é…ç½®) / `discord` (å·²é…ç½®) |
| Webhook URL | `http://127.0.0.1:18789/webhooks/email-notify` |
| Gateway Token | è§ `openclaw gateway status` |

---

## äº”ã€å®žçŽ°æ­¥éª¤

### Phase 1: åŸºç¡€åŠŸèƒ½ (é¢„è®¡ 1-2 å¤©)

1. åˆ›å»º Python é¡¹ç›® `openclaw-email-watcher/`
2. å®žçŽ° IMAP è¿žæŽ¥å’Œé‚®ä»¶ç›‘å¬
3. å®žçŽ°é‚®ä»¶è§£æžï¼ˆçº¯æ–‡æœ¬ + HTMLï¼‰
4. é›†æˆ DashScope qwen-max åš AI æ€»ç»“
5. é€šè¿‡é£žä¹¦ API å‘é€é€šçŸ¥å¡ç‰‡

### Phase 2: å¢žå¼ºåŠŸèƒ½ (é¢„è®¡ 1-2 å¤©)

6. æ·»åŠ è¿‡æ»¤è§„åˆ™å¼•æ“Ž
7. æ·»åŠ é‚®ä»¶æ±‡æ€»ï¼ˆdigestï¼‰æ¨¡å¼
8. æ·»åŠ å·²å¤„ç†é‚®ä»¶è®°å½•ï¼ˆé¿å…é‡å¤é€šçŸ¥ï¼‰
9. æ·»åŠ  systemd/launchd æœåŠ¡åŒ–éƒ¨ç½²

### Phase 3: æ·±åº¦é›†æˆ (é¢„è®¡ 2-3 å¤©)

10. å¼€å‘ OpenClaw Webhook æŽ¥å£
11. å°†é‚®ä»¶æ‘˜è¦å†™å…¥ OpenClaw memoryï¼ˆä¾¿äºŽå¯¹è¯æŸ¥è¯¢ï¼‰
12. æ”¯æŒé€šè¿‡é£žä¹¦/Discord å›žå¤é‚®ä»¶
13. æ”¯æŒé™„ä»¶é¢„è§ˆå’Œè½¬å‘

---

## å…­ã€é¡¹ç›®ç»“æž„

```
openclaw-email-watcher/
â”œâ”€â”€ config.yaml              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt         # Python ä¾èµ–
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # å…¥å£
â”‚   â”œâ”€â”€ imap_listener.py     # IMAP ç›‘å¬
â”‚   â”œâ”€â”€ email_parser.py      # é‚®ä»¶è§£æž
â”‚   â”œâ”€â”€ ai_summarizer.py     # AI æ€»ç»“
â”‚   â”œâ”€â”€ notifier.py          # é€šçŸ¥åˆ†å‘
â”‚   â”‚   â”œâ”€â”€ feishu.py        # é£žä¹¦é€šçŸ¥
â”‚   â”‚   â”œâ”€â”€ discord.py       # Discord é€šçŸ¥
â”‚   â”‚   â””â”€â”€ webhook.py       # OpenClaw Webhook
â”‚   â”œâ”€â”€ filters.py           # è¿‡æ»¤è§„åˆ™
â”‚   â””â”€â”€ storage.py           # å·²å¤„ç†è®°å½•
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ feishu_card.json     # é£žä¹¦å¡ç‰‡æ¨¡æ¿
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_parser.py
â””â”€â”€ deploy/
    â”œâ”€â”€ com.openclaw.email-watcher.plist  # macOS LaunchAgent
    â””â”€â”€ email-watcher.service             # Linux systemd
```

---

## ä¸ƒã€é£Žé™©ä¸Žæ³¨æ„äº‹é¡¹

| é£Žé™© | è¯´æ˜Ž | åº”å¯¹æŽªæ–½ |
|------|------|----------|
| é‚®ç®±å®‰å…¨ | åº”ç”¨å¯†ç æ³„éœ² | ä½¿ç”¨çŽ¯å¢ƒå˜é‡å­˜å‚¨ï¼Œä¸å…¥ä»£ç åº“ |
| IMAP è¿žæŽ¥æ–­å¼€ | ç½‘ç»œä¸ç¨³å®šå¯¼è‡´é•¿è¿žæŽ¥ä¸­æ–­ | å®žçŽ°è‡ªåŠ¨é‡è¿ž + æŒ‡æ•°é€€é¿ |
| é‚®ä»¶é‡è¿‡å¤§ | å¤§é‡é‚®ä»¶å¯¼è‡´ API è°ƒç”¨çˆ†å¢ž | è®¾ç½®é€ŸçŽ‡é™åˆ¶ + è¿‡æ»¤è§„åˆ™ |
| HTML è§£æžå¤±è´¥ | å¤æ‚ HTML é‚®ä»¶æå–ä¸å®Œæ•´ | å¤šé‡ fallbackï¼šHTMLâ†’çº¯æ–‡æœ¬â†’æˆªå– |
| é™„ä»¶å¤„ç† | å¤§é™„ä»¶å ç”¨å­˜å‚¨ | ä»…è®°å½•é™„ä»¶åï¼Œä¸ä¸‹è½½ |
| Token æ¶ˆè€— | é•¿é‚®ä»¶æ¶ˆè€—å¤§é‡ LLM token | æˆªæ–­æ­£æ–‡åˆ° 3000 å­—ç¬¦ |
| é‡å¤é€šçŸ¥ | æœåŠ¡é‡å¯åŽé‡æ–°æ‰«æ | è®°å½•å·²å¤„ç† UIDï¼ŒæŒä¹…åŒ–åˆ° SQLite |

---

## å…«ã€ä¾èµ–æ¸…å•

```txt
# requirements.txt
imapclient>=3.0.0
beautifulsoup4>=4.12.0
openai>=1.40.0
pyyaml>=6.0
requests>=2.31.0
python-dotenv>=1.0.0
```
