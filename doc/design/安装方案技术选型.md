# OpenClaw 安装方案技术选型

> **平台**: macOS (darwin)
> **日期**: 2026-02-13
> **版本**: 2026.2.12

---

## 一、背景

OpenClaw 是一个自托管的多通道 AI 助手网关平台，核心基于 Node.js/TypeScript 构建，支持 30+ 消息通道（WhatsApp、Telegram、Discord、Slack 等），包含 macOS/iOS/Android 原生应用，以及浏览器控制、Canvas、Cron 等工具生态。

本文档梳理在 macOS 环境下 OpenClaw 的各种安装方案，从**扩展性、后期维护、组件支持、稳定性**四个核心维度进行对比分析，为安装选型提供依据。

---

## 二、系统要求

| 依赖项 | 要求 |
|--------|------|
| Node.js | ≥ 22.12.0 |
| pnpm | 10.23.0（仅源码安装需要） |
| Git | 必须 |
| Docker | 可选（容器化/沙盒场景） |
| macOS | 支持 |

---

## 三、安装方案概览

| 方案 | 简述 | 适用场景 |
|------|------|----------|
| **方案1**: 官方安装脚本 | `curl \| bash` 一键安装 | 快速体验、初次使用 |
| **方案2**: npm/pnpm 全局安装 | 包管理器全局安装 | 熟悉 Node 生态的用户 |
| **方案3**: 基于源码安装 | 克隆仓库编译安装 | 开发者/需要定制化 |
| **方案4**: Docker 容器化安装 | Docker Compose 部署 | 隔离环境/服务器部署 |
| **方案5**: Nix 声明式安装 | Nix + Home Manager | 可复现/声明式管理 |
| **方案6**: Bun 运行时（实验性） | 使用 Bun 代替 Node | 极速开发循环（实验性） |

---

## 四、各方案详细分析

### 方案1：官方安装脚本（Installer Script）

#### 安装命令
```bash
curl -fsSL https://openclaw.ai/install.sh | bash
```

#### 工作流程
1. 检测 macOS 系统，缺少 Homebrew 则自动安装
2. 检查并安装 Node.js 22+（通过 Homebrew）
3. 检查并安装 Git
4. 通过 npm 全局安装 OpenClaw
5. 运行 `openclaw doctor` 检查
6. 启动 onboarding 向导

#### 评估

| 维度 | 评分 | 说明 |
|------|------|------|
| **扩展性** | ⭐⭐ | 安装后为 npm 全局包，扩展能力有限，插件管理依赖官方机制 |
| **后期维护** | ⭐⭐⭐ | `npm update -g openclaw` 升级简单，但无版本回滚能力 |
| **组件支持** | ⭐⭐⭐ | 支持完整的 CLI、通道、工具，但 macOS 原生应用需额外安装 |
| **稳定性** | ⭐⭐⭐⭐ | 官方推荐方式，脚本经过完善的错误处理，默认处理 sharp/libvips 兼容 |

#### 优点
- 最简单的安装方式，一条命令完成
- 自动处理依赖检测和安装
- 内置 onboarding 向导引导配置
- 支持 `--dry-run`、`--no-onboard` 等丰富参数

#### 缺点
- `curl | bash` 存在安全隐患（建议先审查脚本）
- 无法精细控制安装版本和构建过程
- 升级时无法回滚到上一版本
- 不适合需要修改源码的场景

---

### 方案2：npm/pnpm 全局安装

#### 安装命令
```bash
# npm 方式
npm install -g openclaw@latest
openclaw onboard --install-daemon

# pnpm 方式
pnpm add -g openclaw@latest
pnpm approve-builds -g
openclaw onboard --install-daemon
```

#### 评估

| 维度 | 评分 | 说明 |
|------|------|------|
| **扩展性** | ⭐⭐ | 全局包模式，扩展受限于 npm 生态机制 |
| **后期维护** | ⭐⭐⭐ | 可指定版本号安装/回退，如 `npm install -g openclaw@2026.1.x` |
| **组件支持** | ⭐⭐⭐ | 与方案1相同，完整 CLI 支持 |
| **稳定性** | ⭐⭐⭐⭐ | 成熟的包管理机制，依赖解析可靠 |

#### 优点
- 标准 Node.js 生态安装方式，用户熟悉
- 可精确指定版本号 (`@latest`, `@beta`, `@具体版本`)
- pnpm 支持更严格的依赖管理
- 与系统其他 Node.js 项目共存良好

#### 缺点
- 需要用户自行确保 Node.js 22+ 环境
- macOS 上可能遇到 `sharp` 编译问题（需设置 `SHARP_IGNORE_GLOBAL_LIBVIPS=1`）
- pnpm 需要额外执行 `approve-builds` 步骤
- 全局安装可能与系统 Node.js 版本管理工具（nvm/fnm）冲突

---

### 方案3：基于源码安装（推荐开发者）

#### 安装命令
```bash
git clone https://github.com/openclaw/openclaw.git
cd openclaw
# 切换到最新 tag 版本
git checkout $(git describe --tags --abbrev=0)
pnpm install
pnpm ui:build
pnpm build
pnpm link --global
openclaw onboard --install-daemon
```

#### 评估

| 维度 | 评分 | 说明 |
|------|------|------|
| **扩展性** | ⭐⭐⭐⭐⭐ | 完全控制源码，可修改任何组件，可开发自定义插件/扩展 |
| **后期维护** | ⭐⭐⭐⭐ | Git 管理版本，可自由切换 tag/branch，支持回滚 |
| **组件支持** | ⭐⭐⭐⭐⭐ | 可构建全部组件（CLI、UI、extensions、macOS 应用等） |
| **稳定性** | ⭐⭐⭐ | 依赖构建环境，构建过程可能因环境差异失败 |

#### 优点
- **最高扩展性**：可自由修改源码、开发插件、定制功能
- **完整组件访问**：可构建所有子组件（30+ extensions、UI、macOS 应用）
- **版本管理灵活**：Git tag/branch 切换，支持精确版本回滚
- **开发友好**：支持 `pnpm openclaw ...` 直接运行，无需全局链接
- **深度调试**：可直接查看和修改运行时代码

#### 缺点
- 安装步骤较多，需要 pnpm 环境
- 构建耗时较长（需编译 TypeScript + UI）
- 需要理解 monorepo 结构（pnpm workspace）
- 更新需要手动 `git pull` + 重新构建

---

### 方案4：Docker 容器化安装

#### 安装命令
```bash
git clone https://github.com/openclaw/openclaw.git
cd openclaw
./docker-setup.sh
```

#### 架构说明
Docker 部署包含两种模式：
- **容器化网关（Containerized Gateway）**：整个 OpenClaw 运行在 Docker 中
- **沙盒模式（Agent Sandbox）**：网关在宿主机运行，工具执行在 Docker 中隔离

#### 评估

| 维度 | 评分 | 说明 |
|------|------|------|
| **扩展性** | ⭐⭐⭐ | 支持自定义镜像、额外挂载、apt 包安装，但受容器边界限制 |
| **后期维护** | ⭐⭐⭐⭐ | 镜像版本化管理，可精确回滚，环境完全隔离 |
| **组件支持** | ⭐⭐⭐ | CLI + 网关完整支持，但 macOS 原生应用（菜单栏、语音唤醒）无法在容器中运行 |
| **稳定性** | ⭐⭐⭐⭐⭐ | 环境完全隔离，不受宿主机环境影响，可复现 |

#### 优点
- **环境隔离**：不污染宿主机环境
- **可复现性强**：镜像确保一致的运行环境
- **安全性好**：支持沙盒隔离、非 root 用户运行、网络限制
- **运维友好**：Docker Compose 一键启停，支持健康检查
- **支持多种扩展**：`OPENCLAW_DOCKER_APT_PACKAGES`、`OPENCLAW_EXTRA_MOUNTS`、`OPENCLAW_HOME_VOLUME`

#### 缺点
- **macOS 原生功能缺失**：无法使用 macOS 菜单栏应用、Voice Wake、Talk Mode
- Docker Desktop 资源开销（内存、CPU）
- macOS 上 Docker 性能弱于 Linux（文件系统 I/O）
- 通道登录（如 WhatsApp QR 扫码）需要额外步骤
- 调试不如本地安装直观

---

### 方案5：Nix 声明式安装

#### 安装方式
通过 [nix-openclaw](https://github.com/openclaw/nix-openclaw) 仓库，使用 Home Manager 模块。

```bash
# 安装 Determinate Nix
curl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix | sh

# 创建本地 flake 并使用 nix-openclaw 模板
```

#### 评估

| 维度 | 评分 | 说明 |
|------|------|------|
| **扩展性** | ⭐⭐⭐⭐ | 声明式配置，支持插件系统，可组合 Nix 包 |
| **后期维护** | ⭐⭐⭐⭐⭐ | 一键回滚 (`home-manager switch --rollback`)，完全可复现 |
| **组件支持** | ⭐⭐⭐⭐⭐ | Gateway + macOS 应用 + 工具全部 pin 管理，launchd 服务自动管理 |
| **稳定性** | ⭐⭐⭐⭐⭐ | 所有依赖版本锁定，构建完全确定性 |

#### 优点
- **最佳可复现性**：所有依赖精确 pin，构建确定性
- **即时回滚**：`home-manager switch --rollback` 一条命令
- **macOS 深度集成**：launchd 服务自动管理、重启后自动运行
- **声明式配置**：配置即代码，版本管理友好
- **安全**：自动禁用自安装和自变更流程

#### 缺点
- **学习曲线陡峭**：需要掌握 Nix/Flake/Home Manager 概念
- **初始设置复杂**：需安装 Nix、创建 flake、配置 Home Manager
- **生态封闭**：Nix 包管理与系统 brew/npm 独立，调试需要 Nix 知识
- **构建时间长**：首次构建需下载大量 Nix 依赖
- **社区较小**：遇到问题时可参考资料相对较少

---

### 方案6：Bun 运行时（实验性）

#### 安装命令
```bash
git clone https://github.com/openclaw/openclaw.git
cd openclaw
bun install
bun run build
```

#### 评估

| 维度 | 评分 | 说明 |
|------|------|------|
| **扩展性** | ⭐⭐⭐ | 与源码方案类似，但部分脚本仍依赖 pnpm |
| **后期维护** | ⭐⭐ | 实验性支持，文档不完善，遇到问题排查难度大 |
| **组件支持** | ⭐⭐ | WhatsApp/Telegram 存在已知 Bug，部分脚本不兼容 |
| **稳定性** | ⭐ | 官方明确标注「不推荐用于 Gateway 运行时」 |

#### 优点
- 安装速度极快（Bun 安装比 npm/pnpm 快）
- 本地开发循环速度快（`bun --watch`）
- TypeScript 直接运行无需编译

#### 缺点
- **官方不推荐生产使用**，WhatsApp/Telegram 有已知 Bug
- 部分脚本（`docs:build`、`ui:*`）仍需 pnpm
- `bun.lock` 与 `pnpm-lock.yaml` 独立，依赖版本可能不一致
- lifecycle scripts 默认被 block，需要手动 trust

---

## 五、四维度综合对比

### 5.1 扩展性

| 方案 | 评分 | 关键因素 |
|------|------|----------|
| 方案3 源码安装 | ⭐⭐⭐⭐⭐ | 完整源码访问，可修改任何组件，自定义插件开发 |
| 方案5 Nix | ⭐⭐⭐⭐ | 声明式扩展，Nix overlay 自定义 |
| 方案4 Docker | ⭐⭐⭐ | 自定义镜像、额外挂载，但受容器边界限制 |
| 方案6 Bun | ⭐⭐⭐ | 源码级别但兼容性限制 |
| 方案1 脚本安装 | ⭐⭐ | npm 全局包，插件通过官方机制 |
| 方案2 npm/pnpm | ⭐⭐ | 同方案1 |

### 5.2 后期维护

| 方案 | 评分 | 关键因素 |
|------|------|----------|
| 方案5 Nix | ⭐⭐⭐⭐⭐ | 即时回滚、完全可复现、声明式管理 |
| 方案4 Docker | ⭐⭐⭐⭐ | 镜像版本化、环境隔离、Compose 管理 |
| 方案3 源码安装 | ⭐⭐⭐⭐ | Git 版本管理、tag 切换、可回滚 |
| 方案2 npm/pnpm | ⭐⭐⭐ | 版本指定、但回滚需重装 |
| 方案1 脚本安装 | ⭐⭐⭐ | 简单升级但无回滚 |
| 方案6 Bun | ⭐⭐ | 实验性，维护资料少 |

### 5.3 组件支持

| 方案 | 评分 | 关键因素 |
|------|------|----------|
| 方案3 源码安装 | ⭐⭐⭐⭐⭐ | 全部组件：CLI + UI + 30+ 扩展 + macOS 应用 |
| 方案5 Nix | ⭐⭐⭐⭐⭐ | Gateway + macOS 应用 + 全部工具链 |
| 方案1 脚本安装 | ⭐⭐⭐ | CLI + 通道 + 工具，macOS 应用需额外安装 |
| 方案2 npm/pnpm | ⭐⭐⭐ | 同方案1 |
| 方案4 Docker | ⭐⭐⭐ | CLI + 网关，但缺失 macOS 原生功能 |
| 方案6 Bun | ⭐⭐ | 部分通道不可用，脚本兼容性问题 |

### 5.4 稳定性

| 方案 | 评分 | 关键因素 |
|------|------|----------|
| 方案5 Nix | ⭐⭐⭐⭐⭐ | 确定性构建、依赖锁定、不受环境影响 |
| 方案4 Docker | ⭐⭐⭐⭐⭐ | 环境完全隔离、可复现 |
| 方案1 脚本安装 | ⭐⭐⭐⭐ | 官方推荐，错误处理完善 |
| 方案2 npm/pnpm | ⭐⭐⭐⭐ | 成熟包管理 |
| 方案3 源码安装 | ⭐⭐⭐ | 依赖构建环境，可能因环境差异失败 |
| 方案6 Bun | ⭐ | 实验性，已知 Bug |

---

## 六、综合评分表

| 方案 | 扩展性 | 后期维护 | 组件支持 | 稳定性 | **综合** |
|------|--------|----------|----------|--------|----------|
| 方案1 安装脚本 | 2 | 3 | 3 | 4 | **3.0** |
| 方案2 npm/pnpm | 2 | 3 | 3 | 4 | **3.0** |
| 方案3 源码安装 | 5 | 4 | 5 | 3 | **4.25** |
| 方案4 Docker | 3 | 4 | 3 | 5 | **3.75** |
| 方案5 Nix | 4 | 5 | 5 | 5 | **4.75** |
| 方案6 Bun | 3 | 2 | 2 | 1 | **2.0** |

---

## 七、场景推荐

### 场景 A：个人开发 / 深度定制（推荐方案3）
- 需要修改源码或开发自定义插件
- 希望使用全部组件（包括 macOS 原生应用）
- 可接受手动构建和更新

### 场景 B：追求稳定 + 可复现（推荐方案5）
- 已有 Nix 使用经验或愿意学习
- 重视版本回滚和配置即代码
- 需要 macOS launchd 服务管理

### 场景 C：快速体验 / 初次使用（推荐方案1）
- 首次接触 OpenClaw
- 只需基本功能
- 不想折腾环境配置

### 场景 D：服务器部署 / 隔离环境（推荐方案4）
- 在服务器上运行（非 macOS 桌面）
- 需要环境隔离和安全沙盒
- 不需要 macOS 原生功能

### 场景 E：不推荐（方案6）
- Bun 目前为实验性支持，WhatsApp/Telegram 有已知 Bug
- 官方明确声明不推荐用于 Gateway 运行时

---

## 八、macOS 专项考量

在 macOS 环境下，以下因素值得特别关注：

| 考量点 | 说明 |
|--------|------|
| **macOS 原生应用** | 菜单栏控制、Voice Wake、Talk Mode 等功能仅方案3/5支持完整构建 |
| **Homebrew 集成** | 方案1 会自动安装 Homebrew（如果缺失）|
| **launchd 守护进程** | `openclaw onboard --install-daemon` 安装 macOS 守护进程，重启自动运行 |
| **sharp/libvips 兼容** | macOS + Homebrew 环境可能遇到 sharp 编译问题，需设置 `SHARP_IGNORE_GLOBAL_LIBVIPS=1` |
| **Docker 性能** | macOS 上 Docker Desktop 文件系统 I/O 性能较 Linux 差，影响方案4性能 |
| **Nix on macOS** | 需要使用 Determinate Nix 安装器，完美支持 macOS + launchd |

---

## 九、建议的最终方案

### 首选：方案3（基于源码安装）

对于个人 macOS 开发机，**基于源码安装是最均衡的选择**：

1. **扩展性最强**：完整源码访问，30+ 扩展可自由修改
2. **组件最全**：可构建 macOS 原生应用、全部 UI、全部通道
3. **版本管理灵活**：Git tag 切换，随时回滚
4. **开发体验好**：修改代码后快速验证

### 辅助：方案4（Docker 沙盒）

在方案3的基础上，建议同时配置 Docker 沙盒：
- 网关在宿主机运行（方案3）
- Agent 工具执行在 Docker 容器中隔离
- 兼顾开发灵活性和运行安全性

---

## 十、后续行动

- [ ] 确定最终安装方案
- [ ] 执行安装并记录脚本到 `doc/script/`
- [ ] 配置通道和模型（参考 `doc/ref/config.md`）
- [ ] 验证安装（`openclaw doctor` + `openclaw status`）
- [ ] 记录使用文档到 `doc/sum/`
